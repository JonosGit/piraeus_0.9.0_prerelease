version: '3.1'
services:
  webgateway:
    build: 
      context: ./webgateway
      dockerfile: Dockerfile
    container_name: webgateway
    image: webgateway
    networks:
      - front
    depends_on:
      - orleans-silo
    links:
      - orleans-silo:latest
  tcpudpgateway:
    build:
      context: ./tcpudpgateway
      dockerfile: Dockerfile
    container_name: tcpudpgateway
    image: tcpudpgateway
    networks:
      - back
    ports:
      - "1883:1883/tcp"
      - "8883:8883/tcp"
      - "5683:5683/udp"
      - "5684:5684/tcp"
      - "5883:5883/udp"
    links:
      - orleans-silo:latest
    depends_on:
      - orleans-silo
  orleans-silo:
    build:
      context: ./orleans-silo
      dockerfile: Dockerfile
    container_name: orleans-silo
    image: orleans-silo
    networks:
      - back
    ports:
      - "11111:11111/tcp"
      - "30000:30000/tcp"
networks:
    front:
        # use the bridge driver, but enable IPv6
        driver: l2bridge 
    back:
        driver: l2bridge